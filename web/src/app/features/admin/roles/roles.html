<div class="roles-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-left">
      <h1>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</h1>
    </div>
    <button type="button" class="btn btn-primary" (click)="openCreateDialog()">
      <span>+</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó
    </button>
  </div>

  <!-- Search -->
  <app-search-box
    placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó..."
    (search)="onSearch($event)"
  />

  <!-- Table -->
  <div class="table-container">
    @if (isLoading()) {
      <div class="loading-overlay">
        <app-loading text="Loading Roles..." [overlay]="false"></app-loading>
      </div>
    }

    <table class="data-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</th>
          <th>‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
          <th>‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
        </tr>
      </thead>
      <tbody>
        @for (role of roles(); track role.id) {
          <tr>
            <td>{{ role.id }}</td>
            <td>{{ role.name }}</td>
            <td>{{ formatDate(role.created_at) }}</td>
            <td class="actions">
              <button type="button" class="btn-icon" title="‡∏™‡∏¥‡∏ó‡∏ò‡∏¥" (click)="openPermissionDialog(role)">üîë</button>
              <button type="button" class="btn-icon" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" (click)="openEditDialog(role)">‚úèÔ∏è</button>
              <button type="button" class="btn-icon btn-danger" title="‡∏•‡∏ö" (click)="openDeleteDialog(role)">üóëÔ∏è</button>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="4" class="empty-state">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</td>
          </tr>
        }
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  @if (pagination()) {
    <div class="pagination-info">
      <div class="per-page-selector">
        <label for="per-page">‡πÅ‡∏™‡∏î‡∏á</label>
        <select id="per-page" [value]="perPage()" (change)="onPerPageChange($event)">
          @for (option of perPageOptions; track option) {
            <option [value]="option">{{ option }}</option>
          }
        </select>
        <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
      </div>
     @if (totalPages() > 1) {
        <app-pagination
          [currentPage]="currentPage()"
          [totalPages]="totalPages()"
          (pageChange)="onPageChange($event)"
        />
      } @else {
        <span class="page-info">‡∏´‡∏ô‡πâ‡∏≤ {{ currentPage() }} ‡∏à‡∏≤‡∏Å {{ totalPages() }}</span>
      }
      <span class="total-count">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ pagination()?.total ?? 0 }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
    </div>
  }
</div>

<!-- Create Dialog -->
<app-dialog [isOpen]="isCreateDialogOpen()" title="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡πÉ‡∏´‡∏°‡πà" (close)="closeCreateDialog()">
  <form [formGroup]="createForm" (ngSubmit)="submitCreate()">
    <div class="form-group">
      <label for="create-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
      <input id="create-name" type="text" formControlName="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó" />
      @if (createForm.controls.name.touched && createForm.controls.name.errors) {
        <span class="error">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
      }
    </div>
    <div class="dialog-actions">
      <button type="button" class="btn btn-secondary" (click)="closeCreateDialog()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button type="submit" class="btn btn-primary" [disabled]="isSubmitting()">
        @if (isSubmitting()) { ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... } @else { ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å }
      </button>
    </div>
  </form>
</app-dialog>

<!-- Edit Dialog -->
<app-dialog [isOpen]="isEditDialogOpen()" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó" (close)="closeEditDialog()">
  <form [formGroup]="editForm" (ngSubmit)="submitEdit()">
    <div class="form-group">
      <label for="edit-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó</label>
      <input id="edit-name" type="text" formControlName="name" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó" />
      @if (editForm.controls.name.touched && editForm.controls.name.errors) {
        <span class="error">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£</span>
      }
    </div>
    <div class="dialog-actions">
      <button type="button" class="btn btn-secondary" (click)="closeEditDialog()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button type="submit" class="btn btn-primary" [disabled]="isSubmitting()">
        @if (isSubmitting()) { ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... } @else { ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å }
      </button>
    </div>
  </form>
</app-dialog>

<!-- Delete Confirmation Dialog -->
<app-dialog [isOpen]="isDeleteDialogOpen()" title="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö" (close)="closeDeleteDialog()">
  <div class="confirm-content">
    <p>‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó <strong>{{ selectedRole()?.name }}</strong> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
    <p class="warning">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
  </div>
  <div class="dialog-actions">
    <button type="button" class="btn btn-secondary" (click)="closeDeleteDialog()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <button type="button" class="btn btn-danger" [disabled]="isSubmitting()" (click)="confirmDelete()">
      @if (isSubmitting()) { ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö... } @else { ‡∏•‡∏ö }
    </button>
  </div>
</app-dialog>

<!-- Permission Dialog -->
<app-dialog [isOpen]="isPermissionDialogOpen()" title="‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ó‡∏ò‡∏¥" (close)="closePermissionDialog()">
  <div class="permission-content">
    <p class="permission-role">‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó: <strong>{{ selectedRole()?.name }}</strong></p>
    <div class="permission-list">
      @for (permission of permissions(); track permission.id) {
        <label class="permission-item" (click)="togglePermission(permission.id)">
          <input
            type="checkbox"
            [checked]="hasPermission(permission.id)"
            (change)="$event.stopPropagation()"
          />
          <span class="permission-name">{{ formatPermission(permission) }}</span>
        </label>
      } @empty {
        <p class="empty">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ó‡∏ò‡∏¥</p>
      }
    </div>
  </div>
</app-dialog>
